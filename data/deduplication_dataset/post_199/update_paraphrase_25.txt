본 글에서는 GEPA를 활용한 DSPy 프롬프트 최적화 기법을 통해 AI 데이터 과학 영역에서 활용되는 AI 코딩 에이전트의 성능을 향상시키는 기술적 접근 방식을 상세히 다룹니다. AI 데이터 과학자들을 위한 AI 코딩 에이전트는 복잡한 데이터 처리 및 분석 작업을 자동화하는 데 핵심적인 역할을 수행합니다. 본 블로그는 이러한 에이전트의 효율성을 극대화하기 위한 프롬프트 최적화 전략에 초점을 맞추며, 다음 주요 주제들을 심층적으로 탐구합니다:

*   데이터 준비 및 특성 분석
*   GEPA(Generic-Pareto Evolutionary Prompt Optimizer)의 원리
*   DSPy 프레임워크를 통한 GEPA 기반 프롬프트 최적화 적용
*   최적화 결과 및 성능 분석

Youssef Hosni · 6월 17일

### 1. 데이터 준비: AI 코딩 에이전트 최적화를 위한 기반 다지기

저희가 활용한 데이터셋은 자체 개발한 플랫폼에서 수행된 파이썬 코드 실행의 산출물로 이루어져 있습니다. 이 데이터는 AI 코딩 에이전트가 실제 환경에서 어떻게 작동하는지를 반영하며, 성공 및 실패 사례를 모두 포함하고 있습니다. 자동 분석 에이전트(auto-analyst agent)는 다수의 모듈로 이루어진 AI 시스템으로서, 각 모듈은 특정 코딩 목표를 달성하도록 설계되었습니다. 예를 들어, 전처리 에이전트(pre-processing agent)는 판다스(pandas) 라이브러리를 활용하여 원시 데이터를 정제하고 분석 가능한 형태로 가공합니다. 또 다른 핵심 모듈인 데이터 시각화 에이전트(data visualization agent)는 플로틀리(plotly)를 사용하여 데이터를 효과적으로 표현하는 차트와 그래프를 생성합니다.

이 시스템에는 약 12개의 고유한 시그니처(signature)가 존재하며, 각 시그니처는 플래너(planner)를 사용하는 버전과 '@agent' 쿼리(query)에 따라 독립적으로 실행되는 두 가지 변형을 가집니다. 본 블로그 포스팅에서는 이 시그니처 중 사용 빈도가 가장 높은 4가지와 그 변형에 집중하여 분석할 것입니다. 이 4가지 시그니처는 전체 코드 실행의 약 90%를 차지할 정도로 광범위하게 사용되며, 이는 무료 및 유료 사용자 모두에게 필수적인 기본 기능이기 때문입니다.

*   `preprocessing_agent`
*   `data_viz_agent`
*   `statistical_analytics_agent`
*   `sk_learn_agent`

데이터셋은 시스템에서 기본적으로 제공하는 데이터셋과 사용자가 직접 업로드하는 데이터로 구분됩니다. 저희의 궁극적인 목표는 어떠한 최적화 과정에서도 두 가지 유형의 데이터 모두에서 성능을 개선하는 것입니다. 특히, 모델이 기본 데이터에만 과적합(overfit)되지 않도록 다양한 사용자 입력에도 효과적으로 반응하도록 설계해야 합니다.

AI 에이전트의 성능 평가에 있어 중요한 고려사항 중 하나는 다양한 모델 제공업체(model providers)입니다. 특정 제공업체에만 최적화하여 다른 제공업체의 성능을 저해하는 상황을 피해야 합니다. 예를 들어, 저희 시스템 사용자들은 OpenAI의 GPT-4o-mini와 같은 비용 효율적인 모델을 주로 사용하는 반면, 제미니(Gemini) 사용자의 경우 주로 최상위 모델만을 활용하는 경향이 있습니다. 이러한 사용자 분포의 편향(bias)을 인지하고 평가에 반영하는 것이 중요합니다. 각 모델별로 충분한 평가 데이터를 확보하기 어렵기 때문에, 현재는 제공업체(provider)를 대리 변수(proxy)로 활용하고 있습니다. 다만, 최고급 OAI 모델과 다른 제공업체의 최고급 모델을 비교했을 때, OpenAI의 성공률은 유사한 수준을 보였습니다.

데이터의 계층화(stratification)는 필수적입니다. 이 과정을 통해 모델이 특정 기본 데이터셋에 과도하게 편향되지 않고, 광범위한 입력 유형을 효율적으로 처리할 수 있도록 보장합니다. 계층화된 샘플(stratified sample)을 생성하기 위해 다음과 같은 제약 조건(constraint)을 적용했습니다:

*   최종 샘플에서 기본 데이터셋(is_default_dataset == True)의 비율이 20%를 초과하지 않도록 설정했습니다. 이는 실제 사용자 데이터의 중요성을 강조하기 위함입니다.
*   세 가지 주요 모델 제공업체(openai, anthropic, gemini) 각각이 최종 샘플의 최소 10%를 차지하도록 하여, 특정 제공업체에 대한 편향된 최적화를 방지했습니다.

계층화는 다음 세 가지 핵심 열(column)을 기준으로 수행되었습니다:

*   `model_provider`
*   `is_successful`
*   `is_default_dataset`

이렇게 준비된 계층화된 샘플은 이후 평가를 위한 훈련 세트(training set)와 테스트 세트(test set)로 분할되어, 모델의 일반화 성능을 객관적으로 측정할 수 있도록 하였습니다.

### 2. GEPA 설명: 진화적 프롬프트 최적화의 핵심 원리

GEPA는 'Generic-Pareto'의 약어로, DSPy 프로그램 내에서 AI 프롬프트와 같은 텍스트 기반 구성 요소를 진화시키고 성능을 향상시키기 위해 자기 성찰(reflection) 기법을 활용하는 진화적 프롬프트 최적화 도구입니다. 이 혁신적인 접근 방식은 대규모 언어 모델(LLM)의 고유한 능력을 극대화합니다.

GEPA는 대규모 언어 모델(LLM)이 프로그램의 실행 경로(execution trajectory)를 심도 있게 분석하고, 성공적인 요소와 실패한 요인을 식별하며, 자연어 기반의 자기 성찰을 통해 개선 방안을 제시하는 능력을 효과적으로 활용합니다. 이는 단순히 프롬프트를 조정하는 것을 넘어, LLM 스스로가 자신의 성능을 평가하고 개선 전략을 수립하는 메타 학습(meta-learning) 과정과 유사합니다.

이 과정은 다중 목표(Pareto) 최적화를 기반으로 하여, 더 우수한 프롬프트들을 반복적으로 검증하고 선별함으로써 진화하는 프롬프트 후보들의 계층적 구조(tree)를 형성합니다. 파레토 최적화는 여러 상충하는 목표(예: 정확도, 응답 시간, 비용) 사이에서 최적의 균형점을 찾는 데 유용하며, GEPA는 이를 통해 단일 지표에만 얽매이지 않고 종합적인 성능 향상을 추구합니다.

DSPy 프레임워크 내에서 GEPA가 진화적 프롬프트 최적화기(evolutionary prompt optimizer)로서 수행하는 핵심 단계는 다음과 같습니다:

1.  **초기 프롬프트 생성 및 실행**: 먼저, DSPy 모듈에 대한 초기 프롬프트(예: Few-shot 프롬프트) 세트를 생성하고, 이를 AI 코딩 에이전트에 적용하여 실제 데이터셋에 대한 실행 궤적을 수집합니다.
2.  **LLM 기반 자기 성찰(Reflection)**: 수집된 실행 궤적을 대규모 언어 모델에 입력하여, 각 프롬프트의 성능을 분석하고 어떤 부분이 효과적이었는지, 어떤 부분이 개선될 수 있는지에 대한 자연어 기반의 성찰 보고서를 생성합니다. 이 단계에서 LLM은 코드 오류, 비효율적인 로직, 불필요한 단계 등을 식별합니다.
3.  **개선 제안 및 변이 생성**: LLM은 성찰 결과를 바탕으로 기존 프롬프트를 개선하기 위한 새로운 아이디어나 변이(variant) 프롬프트를 제안합니다. 이는 어휘 변경, 지시 사항 추가, 예시 수정 등 다양한 형태로 나타날 수 있습니다.
4.  **다중 목표 평가**: 제안된 새로운 프롬프트 후보들은 정의된 다중 목표(예: 성공률, 실행 시간, 자원 사용량)에 따라 평가됩니다. 각 프롬프트의 성능은 다차원 벡터로 표현됩니다.
5.  **파레토 최적해 선택 및 진화 트리 구축**: 평가된 프롬프트 후보들 중에서 파레토 최적 전선(Pareto front)에 위치하는 프롬프트들을 선택합니다. 이들은 어떠한 목표에서도 다른 프롬프트보다 열등하지 않은 프롬프트들입니다. 이러한 최적 프롬프트들을 기반으로 진화 트리를 확장하고, 다음 세대의 프롬프트 생성에 활용합니다.
6.  **반복 및 수렴**: 이 과정(생성, 성찰, 개선, 평가, 선택)을 반복적으로 수행하여 점진적으로 더 강력하고 효율적인 프롬프트를 찾아냅니다. 최적화는 성능 향상이 더 이상 미미해지거나 미리 정의된 반복 횟수에 도달할 때까지 계속됩니다.

GEPA는 DSPy의 선언적 프로그래밍 모델과 결합하여, 개발자가 복잡한 프롬프트 엔지니어링 과정에 직접 개입하지 않고도 AI 에이전트의 성능을 자동으로 최적화할 수 있는 강력한 메커니즘을 제공합니다. 다음 섹션에서는 이러한 GEPA의 실제 적용 사례와 그 결과를 심층적으로 분석할 것입니다.